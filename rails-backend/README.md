# Rails Backend Assignment

This repository contains a Rails application. It is a slightly adapted
version of the "Realworld" Rails example app found at 
https://github.com/gothinkster/rails-realworld-example-app.

The app provides a JSON API for a blogging platform with articles,
comments and followers.

When making changes, treat the repository with the same amount of care
you would apply when working with production code.

## Requirements

* Ruby 2.4.1 (consider using [RVM](https://rvm.io/) to install Ruby)

* Tested on Ubuntu (should work on other Linux versions and OS X)

See [`APP_README.md`](./APP_README.md) for instructions on how to run
the server and the test suite.

## Tasks

Originally, only signed in users could leave comments on
articles. Looking at the most recent commits, you see that the
comments controller was changed to allow anonymous comments.

To prevent spam bots from leaving comments, we want to integrate a
[Text Captcha](https://en.wikipedia.org/wiki/CAPTCHA). The most recent
commit added the [`TextCaptcha` module](lib/text_captcha.rb) - a
module to generate and validate simple text based questions which
anonymous users will need to answer when submitting comments.

See the inline doc of the `TextCaptcha` module for usage instructions.

### Add Endpoint to Get Captcha Data

Extend the JSON API to provide an endpoint that can be used by clients
to obtain captcha questions. It could, for example, look like this:

```
GET /comments/captcha.json

{"question": "1 + 1 = ?", "key": "..."}
```

The key is a piece of information generated by the `TextCaptcha` module that
the client will need to pass when answering questions. It is used to
identify the question that the client is answering.

Write tests for the changes that you make.

### Validate Captcha when Creating Comments

Change the `comments#create` action to accept additional params for
the text captcha key and answer.

Signed in users shall still be able to comment without passing a
captcha.

Anonymous users shall be required to pass a text captcha key (obtained
via the endpoint from the previous section) and the corresponding
answer. If the passed captcha answer is not correct the request shall
result in a `unauthorized`/`401` response.

Write tests for the changes that you make.

### Further Reflections

The current implementation of the `TextCaptcha` module simply returns
the index of the question as `key`. What could an attacker do to
create a bot that can still post comments. How could the `TextCaptcha`
module be changed to remove these flaws?

This question is just supposed to be a basis for discussion. No code
changes are required.

## Resources

* [Rails strong parameters](https://edgeguides.rubyonrails.org/action_controller_overview.html#strong-parameters)

* [Rails testing guide](https://guides.rubyonrails.org/testing.html#functional-tests-for-your-controllers)

* [`FactoryBot` library (used for test fixtures)](https://github.com/thoughtbot/factory_bot)
